<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
    <head th:include="base :: header"></head>
    <body> 
        <nav th:include="navbar :: navigation"></nav>

        <div class="container">
            <p class="lead" th:inline="text">Challenge: [[${challenge.name}]]</p>
            <p th:text="${challenge.desc}"></p>
            <div class="row">
                <div class="col-md-4">
                    <p th:inline="text">Task: [[${task.name}]]</p><br/>
                    <p th:inline="text">Level: [[${task.level}]]</p><br/>
                </div>
                <div class="col-md-6">
                    <p th:text="${task.desc}"></p><br/><br/>
                </div>
            </div>
            <div th:if="${errors}" class="row">
                <p>The following errors were encountered:</p>
                <ul>
                    <li th:each="error : ${errors}">
                        <span th:text="${error}"></span>
                    </li>
                </ul>
            </div>
            <ul class="nav nav-tabs">        
                <li class="active">
                    <a data-toggle="tab" th:text="${implementationFileName}" href="#implementation">Placeholder editors</a>
                </li>
                <li>
                    <a data-toggle="tab" th:text="${testFileName}" href="#test">Placeholder editors</a>
                </li>
            </ul>
            <form method="post" th:action="@{/task}">
                <div class="tab-content" th:inline="text">
                    <input type="hidden" name="challengeId" th:value="${challenge.id}" />
                    <input type="hidden" name="taskId" th:value="${task.taskId}" />
                    <div id="implementation" class="panel panel-default tab-pane fade in active">
                        <div class="panel-heading">
                            <h3 class="panel-title" th:text="${implementationFileName}"></h3>
                        </div>
                        <div class="panel-body">
                            <div id="implementation-editor" style="height: 300px" class="editortab" th:text="${implementationCode}"></div>
                            <textarea name="implementationCode" id="implementation-code" style="display: none;"
                                      th:text="${implementationCode}"/>
                        </div>
                    </div>
                    <div id="test" class="panel panel-default tab-pane fade">
                        <div class="panel-heading">
                            <h3 class="panel-title" th:text="${testFileName}"></h3>
                        </div>
                        <div class="panel-body">
                            <div id="test-editor" style="height: 300px" class="editortab" th:text="${testCode}"></div>
                            <textarea name="testCode" id="test-code" style="display: none;" th:text="${testCode}"/>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" onclick="clicked(event)">Submit</button>
                </div>
            </form>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.8/ace.js" type="text/javascript" charset="utf-8"></script>

        <script>
            function createEditor(editorId, textareaId) {
                let editor = ace.edit(editorId);
                let textarea = document.getElementById(textareaId);

                editor.setTheme("ace/theme/monokai");
                editor.getSession().setMode("ace/mode/java");
                editor.getSession().on("change", () => {
                    textarea.value = editor.getSession().getValue();
                });
            }

            createEditor("implementation-editor", "implementation-code");
            createEditor("test-editor", "test-code");

            function clicked(e) {
                if (!confirm("Are you ready to submit?")) {
                    e.preventDefault();
                }
            }
        </script>
    </body>
</html>
